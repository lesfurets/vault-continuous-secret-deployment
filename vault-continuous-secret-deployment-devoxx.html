<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Deploying your application secrets: Hashicorp Vault and continuous delivery</title>
    <meta name="description" content="Managing application secrets, like database credentials, passphrases, salts and private keys, is hard. The availability of those elements are critical to the application, yet they need to be properly secured to reduce the attack surface on your system. Most secret management systems, like Hashicorp Vault, are used as a centralized database, but it creates a single point of failure and it requires extra care in hardening the security of that system. How about deploying your secrets, in Hashicorp Vault, alongside your application? By leveraging your build infrastructure, you can deploy a copy of your secrets in a Vault that is secured using a one-time token, accessible only by your application. In this presentation, we'll show a continuous delivery pipeline that enables that approach, talk about the implications of handling secrets in your build infrastructure, and use threat modeling to verify the security of the deployed Vault.">
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <link rel="stylesheet" href="bower_components/reveal.js/css/reveal.css">
    <link rel="stylesheet" href="bower_components/reveal.js/lib/css/zenburn.css">
    <link rel="stylesheet" href="css/theme.css" id="theme">
    <script>
      if (window.location.search.match(/print-pdf/gi)) {
        var link = document.createElement('link');
        link.rel = 'stylesheet';
        link.type = 'text/css';
        link.href = 'css/print/pdf.css';
        document.getElementsByTagName('head')[0].appendChild(link);
      }
    </script>
  </head>

  <body>
    <div class="footer">
      <img class="logo-lesfurets" src="img/logo_lesfurets_blanc.png">
      <img class="logo-conference" src="img/logo_devoxx_france.jpg">
    </div>
    <div class="reveal">
      <div class="slides">

        <section>
          <img class="logo herve-francois" width="45%" src="img/lf_com_herve_francois.png">
          <h1>Deploying your application secrets: Hashicorp Vault and continuous delivery</h1>
        </section>

        <section>
          <section>
            <h2>Welcome to the Furets!</h2>
          </section>
          <section>
            <div class="">
              <h2>@dubreuia â€“ Alexandre DuBreuil</h2>
              <ul>
                <li>TODO</li>
              </ul>
            </div>
          </section>
          <section>
            <img width="50%" src="img/logo_lesfurets.png">
            <p></p>
            <ul class="">
              <li>1 website, 5 Insurance Products : Car, Health, Home, Bike, Loan</li>
              <li class="emptyline">1 codebase, 450k lines of code, 60k unit tests, 150 selenium tests</li>
              <li>22 Developers, 2 DevOps, 4 Architects</li>
              <li class="emptyline">19 production servers including Load balancers, Frontend, Backend, Databases, BI</li>
              <li>1 release per day</li>
              <li class="emptyline">9 years of code history
                <br/>
              </li>
              <li>3M quotes/year, 40% of market share, 4M of customers</li>
            </ul>
          </section>
        </section>

        <section>
          <section>
            <h2>Context</h2>
          </section>

          <section data-transition="slide-in fade-out">
            <img width="66%" src="img/lf_car_journey.png">
          </section>

          <section data-transition="fade-in slide-out">
            <img width="66%" src="img/lf_com_car_price_sheet.png">
          </section>

          <section>
            <h2>Web application secrets</h2>
            <p>We define "a secret" as any information that we cannot put on a public repository. That includes:</p>
            <ul>
              <li>Insurer web service credentials (username, password)</li>
              <li>Encryption keys and key passphrases</li>
              <li>Salt for passwords and passphrases</li>
              <li>Database credentials (username, password)</li>
              <li><strong>Out of scope:</strong> customer credentials, PII</li>
            </ul>
          </section>

          <section>
            <h2>Continuous delivery / lambda infrastructure</h2>
            <p>This is required to our approach work: TODO</p>
            <ul>
              <li>Daily delivery: new version of the website everyday</li>
              <li>Lambda infrastructure: easy to create new instances</li>
            </ul>
            <p>TODO overview of CD and infrastructure</p>
          </section>

          <section>
            <h2>Infrastructure as code: secrets in source code</h2>
            <p>If you do infra as code, you have your secrets in your source code. We want to keep infra as code, but remove the secrets.</p>
          </section>

          <section>
            <h2>Automated deployment</h2>
            <p>Our machine provisioning and deployment is done with ansible. Do not try this without ansible or equivalent.</p>
            <p>TODO overview of ansible</p>
          </section>

          <section>
            <h2>Overview of password workflow (from code to production)</h2>
            <p>Different person with different access rights are needed for this.</p>
            <ul>
              <li>Developer use password key in code (ex: <code>insurer_password</code>)</li>
              <li>Developer puts development value in code (ex: <code>hunter123</code>)</li>
              <li>Security admin adds production secret in system</li>
              <li>Developer deploys app without seeing the production value</li>
            </ul>
          </section>

        </section>

        <section>

          <section>
            <h2>Security</h2>
          </section>

          <section>
            <h2>Basic concepts</h2>
            <p>Some concepts are required for this presentation</p>
            <ul>
              <li><strong>Secure Coding:</strong> TODO</li>
              <li><strong>Threat model:</strong> a process by which potential (security) threats can be identified</li>
              <li><strong>Attack surface:</strong> of a software environment is the sum of the different points where an unauthorized user can try to enter data to or extract data from an environment</li>
              <li><strong>Man in the middle:</strong> is an attack where the attacker secretly relays and possibly alters the communication between two parties who believe they are directly communicating with each other</li>
              <li><strong>One time password (OTP):</strong> is a password that is valid for only one login session or transaction</li>
            </ul>
          </section>

          <section>
            <h2>Hashicorp Vault</h2>
            <p>Typical use case of Vault is somewhat different then what we'll see today: it is often used as a central database serving multiple apps and environments.</p>
            <ul>
              <li><strong>Attack surface:</strong> infrastructure wide system with all the info</li>
              <li><strong>Staging</strong> deploying specific secrets for a specific env</li>
              <li><strong>SLA</strong> single point of failure, network issues</li>
              <li><strong>Master / slave</strong> configuration on enterprise solutions</li>
            </ul>
          </section>

          <section>
            <h2>Vault concepts</h2>
            <p>By using seal, token authentication and wrapping, you can implement a one-time connection</p>
            <ul>
              <li><strong>Seal</strong> and unseal is done with a key (or multiple keys)</li>
              <li><strong>Authentication</strong> with different methods, we're using (wrapped) token auth</li>
              <li><strong>Wrap</strong> secrets (like token) makes authenticated single use token possible</li>
            </ul>
          </section>

          <section>
            <h2>Why vault?</h2>
            <p>Lightweight, performant and battle hardened (check comparison https://www.vaultproject.io/docs/vs/index.html)</p>
            <p>https://docs.microsoft.com/en-us/azure/key-vault/vs-secure-secret-appsettings</p>
            <ul>
              <li>TODO state of the art of other products</li>
              <li>TODO compare with Keywhiz, Amazon KMS, etc.</li>
              <li>TODO ansible vault: do not handle production server</li>
            </ul>
          </section>

        </section>

        <section>

          <section>
            <h2>Threat model</h2>
          </section>

          <section>
            <h2>Threat model: STRIDE</h2>
            <p>There are many ways to do a threat model, one of them is using the STRIDE method.</p>
            <ul>
              <li><strong>S</strong>poofing of user identity</li>
              <li><strong>T</strong>ampering</li>
              <li><strong>R</strong>epudiation</li>
              <li><strong>I</strong>nformation disclosure</li>
              <li><strong>D</strong>enial of service</li>
              <li><strong>E</strong>levation of privilege</li>
            </ul>
          </section>

          <section>
            <h2>Production machines</h2>
            <ul>
              <li>production machines only</li>
              <li>1 vault per 1 app</li>
              <li>software factory also possible</li>
            </ul>
          </section>

        </section>

        <section>

          <section>
            <h2>Demo</h2>
          </section>

          <section>
            <h2>Overview of delivery pipeline (jenkins)</h2>
          </section>

          <section data-transition="slide-in fade-out">
            <img width="90%" src="img/vault_infra_01.jpg">
          </section>

          <section data-transition="fade-in slide-out">
            <img width="90%" src="img/vault_infra_02.jpg">
          </section>

          <section>
            <h2>Demo: Deploying vault with ansible</h2>
            <ul>
              <li>from local secrets store</li>
              <li>only what you need</li>
            </ul>
          </section>

          <section>
            <h2>Build infrastructure implications</h2>
            <ul>
              <li>secrets written on disk</li>
              <li>ramfs</li>
              <li>secure vars</li>
            </ul>
          </section>

          <section>
            <h2>Artifact management</h2>
            <ul>
              <li>sealed vault is public</li>
              <li>key and token are not (SF only)</li>
            </ul>
          </section>

          <section>
            <h2>Code demo: Java code to query vault</h2>
            <ul>
              <li>simple rest api</li>
              <li>library used: vault-java-driver</li>
              <li>secure coding: usage in production code</li>
            </ul>
          </section>

          <section>
            <h2>Monitoring</h2>
            <ul>
              <li>Datadog: cpu, mem, process number</li>
              <li>Logmatic: specific alert from vault service</li>
            </ul>
          </section>

        </section>

        <section>

          <section>
            <h2>Performance / scalability</h2>
          </section>

          <section>
            <h2>Decentralized nature makes it easier to manage</h2>
            <ul>
              <li>ex: batch fiches with salt</li>
              <li>statistics from our usage</li>
              <li>avoid network failures (local socket)</li>
            </ul>
          </section>

        </section>

        <section>

          <section>
            <h2>Pitfalls</h2>
          </section>

          <section>
            <h2>Security is hard</h2>
            <ul>
              <li>secrets migration: from cleartext to ciphertext, how to test?</li>
              <li>testing: software factory access to production creds?</li>
              <li>mocking</li>
              <li>build everything, everytime: certificate expiration</li>
              <li>database password in clear in logs</li>
            </ul>
          </section>

        </section>

        <section>

          <section>
            <h2>Conclusion</h2>
          </section>

          <section>
            <h2>TODO</h2>
          </section>

        </section>

      </div>
    </div>
    <script src="bower_components/reveal.js/lib/js/head.min.js"></script>
    <script src="bower_components/reveal.js/js/reveal.js"></script>
    <script>
      // Full list of configuration options available here:
      // https://github.com/hakimel/reveal.js#configuration
      Reveal.initialize({
        controls: false,
        progress: true,
        history: true,
        center: true,
        embedded: true,
        mouseWheel: true,
        viewDistance: 5,

        width: 1280,
        height: 900,
        margin: 0,

        transition: Reveal.getQueryHash().transition || 'linear', // default/cube/page/concave/zoom/linear/fade/none

        // Optional libraries used to extend on reveal.js
        dependencies: [
          { src: 'bower_components/reveal.js/lib/js/classList.js', condition: function () { return !document.body.classList; } },
          { src: 'bower_components/reveal.js/plugin/markdown/marked.js', condition: function () { return !!document.querySelector('[data-markdown]'); } },
          { src: 'bower_components/reveal.js/plugin/markdown/markdown.js', condition: function () { return !!document.querySelector('[data-markdown]'); } },
          //{ src: 'bower_components/reveal.js/plugin/highlight/highlight.js', async: true, callback: function() { hljs.initHighlightingOnLoad(); } },
          { src: 'bower_components/reveal.js/plugin/zoom-js/zoom.js', async: true, condition: function () { return !!document.body.classList; } },
          { src: 'bower_components/reveal.js/plugin/notes/notes.js', async: true, condition: function () { return !!document.body.classList; } }
        ]
      });
    </script>
    <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js"></script>
    <script src="js/script.js"></script>
    <script src="https://cdn.rawgit.com/google/code-prettify/master/loader/run_prettify.js?skin=desert&amp;callback=doov"></script>
  </body>
</html>
<!-- vim: set tabstop=2 softtabstop=2 shiftwidth=2 expandtab smarttab: -->
